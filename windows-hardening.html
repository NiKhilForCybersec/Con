<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Hardening | SIEM Consultant Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <button class="mobile-menu-toggle" aria-label="Toggle navigation"><span></span></button>
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" style="text-decoration: none; color: inherit;">
                    <div class="sidebar-logo"><div class="sidebar-logo-icon">âš¡</div>SIEM Consultant</div>
                </a>
                <div class="sidebar-subtitle">Knowledge Portfolio</div>
            </div>
                        <nav class="sidebar-nav">
                <!-- Foundation -->
                <div class="nav-section">
                    <div class="nav-section-title">Foundation</div>
                    <a href="index.html" class="nav-item">Home</a>
                    <a href="approach.html" class="nav-item">Consulting Approach</a>
                    <a href="deliverables.html" class="nav-item">Project Deliverables</a>
                    <a href="experience.html" class="nav-item">Experience</a>
                </div>
                
                <!-- SIEM Fundamentals -->
                <div class="nav-section">
                    <div class="nav-section-title">SIEM Fundamentals</div>
                    <a href="what-is-siem.html" class="nav-item">What is SIEM?</a>
                    <a href="siem-architecture.html" class="nav-item">SIEM Architecture</a>
                    <a href="siem-data-flow.html" class="nav-item">SIEM Data Flow</a>
                    <a href="platform-comparison.html" class="nav-item">Platform Comparison</a>
                    <a href="siem-metrics.html" class="nav-item">SIEM Metrics</a>
                    <a href="siem-health.html" class="nav-item">SIEM Health</a>
                    <a href="siem-rfp.html" class="nav-item">SIEM RFP Guide</a>
                    <a href="security-data-lake.html" class="nav-item">Security Data Lake</a>
                </div>
                
                <!-- SIEM Platforms -->
                <div class="nav-section">
                    <div class="nav-section-title">SIEM Platforms</div>
                    <a href="splunk-overview.html" class="nav-item">Splunk Overview</a>
                    <a href="splunk-cloud.html" class="nav-item">Splunk Cloud</a>
                    <a href="splunk-hybrid.html" class="nav-item">Splunk Hybrid</a>
                    <a href="sentinel-overview.html" class="nav-item">Microsoft Sentinel</a>
                </div>
                
                <!-- Log Sources -->
                <div class="nav-section">
                    <div class="nav-section-title">Log Sources</div>
                    <a href="log-sources-overview.html" class="nav-item">Log Sources Overview</a>
                    <a href="windows-logs.html" class="nav-item">Windows Logs</a>
                    <a href="linux-logs.html" class="nav-item">Linux Logs</a>
                    <a href="network-logs.html" class="nav-item">Network Logs</a>
                    <a href="cloud-logs.html" class="nav-item">Cloud Logs</a>
                    <a href="endpoint-logs.html" class="nav-item">Endpoint Logs</a>
                    <a href="identity-logs.html" class="nav-item">Identity Logs</a>
                    <a href="application-logs.html" class="nav-item">Application Logs</a>
                </div>
                
                <!-- Log Engineering -->
                <div class="nav-section">
                    <div class="nav-section-title">Log Engineering</div>
                    <a href="log-pipeline.html" class="nav-item">Log Pipeline</a>
                    <a href="log-parsing.html" class="nav-item">Log Parsing</a>
                    <a href="log-retention.html" class="nav-item">Log Retention</a>
                </div>
                
                <!-- SIEM Migrations -->
                <div class="nav-section">
                    <div class="nav-section-title">SIEM Migrations</div>
                    <a href="migration-methodology.html" class="nav-item">Migration Methodology</a>
                    <a href="discovery-assessment.html" class="nav-item">Discovery & Assessment</a>
                    <a href="log-migration.html" class="nav-item">Log Migration</a>
                    <a href="detection-migration.html" class="nav-item">Detection Migration</a>
                    <a href="query-translation.html" class="nav-item">Query Translation</a>
                </div>
                
                <!-- Detection Engineering -->
                <div class="nav-section">
                    <div class="nav-section-title">Detection Engineering</div>
                    <a href="detection-fundamentals.html" class="nav-item">Detection Fundamentals</a>
                    <a href="use-case-development.html" class="nav-item">Use Case Development</a>
                    <a href="tuning-methodology.html" class="nav-item">Tuning Methodology</a>
                    <a href="sigma-rules.html" class="nav-item">Sigma Rules</a>
                    <a href="alert-enrichment.html" class="nav-item">Alert Enrichment</a>
                    <a href="alert-fatigue.html" class="nav-item">Alert Fatigue</a>
                </div>
                
                <!-- Threat Detection -->
                <div class="nav-section">
                    <div class="nav-section-title">Threat Detection</div>
                    <a href="mitre-attack-intro.html" class="nav-item">MITRE ATT&CK</a>
                    <a href="threat-modeling.html" class="nav-item">Threat Modeling</a>
                    <a href="threat-intelligence.html" class="nav-item">Threat Intelligence</a>
                    <a href="threat-hunting.html" class="nav-item">Threat Hunting</a>
                    <a href="ueba-analytics.html" class="nav-item">UEBA Analytics</a>
                </div>
                
                <!-- Query Languages -->
                <div class="nav-section">
                    <div class="nav-section-title">Query Languages</div>
                    <a href="spl-fundamentals.html" class="nav-item">SPL Fundamentals</a>
                    <a href="kql-fundamentals.html" class="nav-item">KQL Fundamentals</a>
                </div>
                
                <!-- Windows Security -->
                <div class="nav-section">
                    <div class="nav-section-title">Windows Security</div>
                    <a href="sysmon-config.html" class="nav-item">Sysmon Configuration</a>
                    <a href="windows-attack-techniques.html" class="nav-item">Windows Attacks</a>
                    <a href="windows-hardening.html" class="nav-item active">Windows Hardening</a>
                    <a href="powershell-security.html" class="nav-item">PowerShell Security</a>
                </div>
                
                <!-- Cloud Security -->
                <div class="nav-section">
                    <div class="nav-section-title">Cloud Security</div>
                    <a href="cloud-security-monitoring.html" class="nav-item">Cloud Monitoring</a>
                    <a href="azure-security.html" class="nav-item">Azure Security</a>
                    <a href="aws-security.html" class="nav-item">AWS Security</a>
                    <a href="gcp-security.html" class="nav-item">GCP Security</a>
                    <a href="m365-security.html" class="nav-item">M365 Security</a>
                    <a href="container-security.html" class="nav-item">Container Security</a>
                </div>
                
                <!-- Network Security -->
                <div class="nav-section">
                    <div class="nav-section-title">Network Security</div>
                    <a href="network-security-monitoring.html" class="nav-item">Network Monitoring</a>
                    <a href="dns-security.html" class="nav-item">DNS Security</a>
                    <a href="zero-trust.html" class="nav-item">Zero Trust</a>
                </div>
                
                <!-- Identity Security -->
                <div class="nav-section">
                    <div class="nav-section-title">Identity Security</div>
                    <a href="identity-security.html" class="nav-item">Identity Security</a>
                    <a href="active-directory.html" class="nav-item">Active Directory</a>
                </div>
                
                <!-- Data Protection -->
                <div class="nav-section">
                    <div class="nav-section-title">Data Protection</div>
                    <a href="dlp-monitoring.html" class="nav-item">DLP Monitoring</a>
                    <a href="data-classification.html" class="nav-item">Data Classification</a>
                    <a href="data-exfiltration.html" class="nav-item">Data Exfiltration</a>
                    <a href="insider-threats.html" class="nav-item">Insider Threats</a>
                </div>
                
                <!-- Specific Threats -->
                <div class="nav-section">
                    <div class="nav-section-title">Threat Scenarios</div>
                    <a href="phishing-detection.html" class="nav-item">Phishing Detection</a>
                    <a href="ransomware-detection.html" class="nav-item">Ransomware Detection</a>
                    <a href="email-security.html" class="nav-item">Email Security</a>
                </div>
                
                <!-- SOC Operations -->
                <div class="nav-section">
                    <div class="nav-section-title">SOC Operations</div>
                    <a href="soc-operations.html" class="nav-item">SOC Operations</a>
                    <a href="incident-response.html" class="nav-item">Incident Response</a>
                    <a href="incident-metrics.html" class="nav-item">Incident Metrics</a>
                    <a href="case-management.html" class="nav-item">Case Management</a>
                    <a href="dashboard-design.html" class="nav-item">Dashboard Design</a>
                    <a href="runbook-development.html" class="nav-item">Runbook Development</a>
                </div>
                
                <!-- Automation -->
                <div class="nav-section">
                    <div class="nav-section-title">Automation</div>
                    <a href="soar-automation.html" class="nav-item">SOAR Automation</a>
                    <a href="security-playbooks.html" class="nav-item">Security Playbooks</a>
                    <a href="python-security.html" class="nav-item">Python for Security</a>
                </div>
                
                <!-- Integrations -->
                <div class="nav-section">
                    <div class="nav-section-title">Integrations</div>
                    <a href="edr-integration.html" class="nav-item">EDR Integration</a>
                    <a href="vulnerability-management.html" class="nav-item">Vulnerability Mgmt</a>
                    <a href="api-security.html" class="nav-item">API Security</a>
                </div>
                
                <!-- Operations -->
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <a href="performance-optimization.html" class="nav-item">Performance</a>
                    <a href="cost-optimization.html" class="nav-item">Cost Optimization</a>
                    <a href="compliance-governance.html" class="nav-item">Compliance</a>
                </div>
                
                <!-- Interview Prep -->
                <div class="nav-section">
                    <div class="nav-section-title">Interview Prep</div>
                    <a href="interview-strategy.html" class="nav-item">â­ Interview Strategy</a>
                    <a href="common-questions.html" class="nav-item">Common Questions</a>
                    <a href="interview-scenarios.html" class="nav-item">Scenarios</a>
                </div>
            </nav>
        </aside>
        <main class="main-content">
            <div class="content-wrapper">
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">/</span>
                    <a href="windows-logs.html">Windows Security</a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current">Windows Hardening</span>
                </nav>

                <header class="page-header">
                    <h1 class="page-title">Windows Hardening Detection</h1>
                    <p class="page-subtitle">Detecting when hardening controls are weakened or bypassed is critical. Attackers often disable security features before executing their payloads. Monitor for defense evasion attempts.</p>
                </header>

                <section class="content-section">
                    <h2>Security Feature Monitoring</h2>
                    
                    <div class="diagram">
                        <div class="diagram-title">Windows Security Controls</div>
                        <pre><code>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WINDOWS SECURITY CONTROLS TO MONITOR                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ENDPOINT PROTECTION           LOGGING & AUDIT              ACCESS CONTROL  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Windows Defenderâ”‚          â”‚ Event Log       â”‚         â”‚ UAC Settings â”‚ â”‚
â”‚  â”‚ â€¢ Real-time     â”‚          â”‚ â€¢ Security log  â”‚         â”‚ â€¢ Elevation  â”‚ â”‚
â”‚  â”‚ â€¢ Cloud protect â”‚          â”‚ â€¢ PowerShell    â”‚         â”‚ â€¢ Consent    â”‚ â”‚
â”‚  â”‚ â€¢ Tamper protectâ”‚          â”‚ â€¢ Sysmon        â”‚         â”‚              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  EXECUTION CONTROL             NETWORK PROTECTION           CREDENTIAL      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ AppLocker/WDAC  â”‚          â”‚ Windows Firewallâ”‚         â”‚ Credential   â”‚ â”‚
â”‚  â”‚ â€¢ Script rules  â”‚          â”‚ â€¢ Inbound rules â”‚         â”‚ Guard        â”‚ â”‚
â”‚  â”‚ â€¢ Exe rules     â”‚          â”‚ â€¢ Profile       â”‚         â”‚ â€¢ LSA        â”‚ â”‚
â”‚  â”‚ â€¢ DLL rules     â”‚          â”‚ â€¢ Logging       â”‚         â”‚   Protection â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  AMSI (Antimalware            POWERSHELL                   ATTACK SURFACE  â”‚
â”‚  Scan Interface)              CONSTRAINED MODE             REDUCTION (ASR) â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Script scanning â”‚          â”‚ Language mode   â”‚         â”‚ Office macrosâ”‚ â”‚
â”‚  â”‚ â€¢ PowerShell    â”‚          â”‚ â€¢ Full          â”‚         â”‚ â€¢ Script     â”‚ â”‚
â”‚  â”‚ â€¢ VBScript      â”‚          â”‚ â€¢ Constrained   â”‚         â”‚   execution  â”‚ â”‚
â”‚  â”‚ â€¢ JavaScript    â”‚          â”‚                 â”‚         â”‚ â€¢ Child proc â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        </code></pre>
                    </div>
                </section>

                <section class="content-section">
                    <h2>Windows Defender Tampering</h2>
                    
                    <div class="info-box tip">
                        <div class="info-box-title">KQL: Defender Disabled via Registry</div>
                        <pre><code>// Detect Defender being disabled
DeviceRegistryEvents
| where TimeGenerated > ago(24h)
| where RegistryKey has_any (
    @"SOFTWARE\Microsoft\Windows Defender",
    @"SOFTWARE\Policies\Microsoft\Windows Defender"
)
| where RegistryValueName in (
    "DisableAntiSpyware",
    "DisableRealtimeMonitoring",
    "DisableBehaviorMonitoring",
    "DisableOnAccessProtection",
    "DisableScanOnRealtimeEnable"
)
| where RegistryValueData == "1"
| project TimeGenerated, DeviceName, InitiatingProcessAccountName,
          RegistryKey, RegistryValueName, InitiatingProcessCommandLine</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">SPL: Defender Service Stopped</div>
                        <pre><code>index=windows EventCode=7036
| where Service_Name IN ("Windows Defender Antivirus Service", 
                         "WinDefend", "WdNisSvc", "SecurityHealthService")
| where Service_State="stopped"
| stats count, values(ComputerName) as hosts by Service_Name
| where count > 0</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">KQL: Defender Exclusions Added</div>
                        <pre><code>// Detect suspicious exclusion additions
DeviceRegistryEvents
| where TimeGenerated > ago(24h)
| where RegistryKey has @"Windows Defender\Exclusions"
| where ActionType == "RegistryValueSet"
| extend ExclusionType = case(
    RegistryKey has "Paths", "Path",
    RegistryKey has "Extensions", "Extension",
    RegistryKey has "Processes", "Process",
    "Other"
)
| project TimeGenerated, DeviceName, ExclusionType, 
          RegistryValueName, InitiatingProcessCommandLine</code></pre>
                    </div>
                </section>

                <section class="content-section">
                    <h2>Audit Policy Changes</h2>
                    
                    <div class="info-box tip">
                        <div class="info-box-title">SPL: Audit Policy Modified</div>
                        <pre><code>index=windows EventCode=4719
| table _time, ComputerName, SubjectUserName, SubjectDomainName,
        CategoryId, SubcategoryGuid, AuditPolicyChanges
| lookup audit_subcategory_names guid as SubcategoryGuid 
    OUTPUT subcategory_name
| where AuditPolicyChanges LIKE "%removed%" OR 
        AuditPolicyChanges LIKE "%disabled%"</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">KQL: Security Log Cleared</div>
                        <pre><code>SecurityEvent
| where TimeGenerated > ago(24h)
| where EventID == 1102  // Security log cleared
| project TimeGenerated, Computer, Account, 
          Activity = "Security Log Cleared"

union (
    SecurityEvent
    | where EventID == 104  // System log cleared
    | project TimeGenerated, Computer, Account,
              Activity = "System Log Cleared"
)</code></pre>
                    </div>
                </section>

                <section class="content-section">
                    <h2>PowerShell Security</h2>
                    
                    <div class="info-box tip">
                        <div class="info-box-title">SPL: PowerShell Logging Disabled</div>
                        <pre><code>index=windows source="WinRegistry"
| where key_path LIKE "%\\PowerShell\\ScriptBlockLogging%"
    OR key_path LIKE "%\\PowerShell\\ModuleLogging%"
    OR key_path LIKE "%\\PowerShell\\Transcription%"
| where data="0" OR ValueName="EnableScriptBlockLogging" AND data="0"
| table _time, host, key_path, ValueName, data</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">KQL: AMSI Bypass Attempts</div>
                        <pre><code>DeviceProcessEvents
| where TimeGenerated > ago(24h)
| where ProcessCommandLine has_any (
    "AmsiScanBuffer",
    "amsiInitFailed",
    "AmsiUtils",
    "amsi.dll",
    "[Ref].Assembly.GetType",
    "System.Management.Automation.AmsiUtils"
)
| project TimeGenerated, DeviceName, AccountName,
          FileName, ProcessCommandLine</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">SPL: Constrained Language Mode Bypass</div>
                        <pre><code>index=windows EventCode=4104
| where ScriptBlockText LIKE "%FullLanguage%"
    OR ScriptBlockText LIKE "%__PSLockdownPolicy%"
    OR ScriptBlockText LIKE "%SystemPolicy%"
| table _time, ComputerName, UserName, ScriptBlockText</code></pre>
                    </div>
                </section>

                <section class="content-section">
                    <h2>Windows Firewall</h2>
                    
                    <div class="info-box tip">
                        <div class="info-box-title">SPL: Firewall Disabled</div>
                        <pre><code>index=windows EventCode=4950
| eval profile = case(
    ProfileChanged LIKE "%Domain%", "Domain",
    ProfileChanged LIKE "%Private%", "Private",
    ProfileChanged LIKE "%Public%", "Public",
    true(), "Unknown"
)
| where NewSetting="Off"
| table _time, ComputerName, profile, OldSetting, NewSetting</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">KQL: Firewall Rule Added</div>
                        <pre><code>SecurityEvent
| where TimeGenerated > ago(24h)
| where EventID == 4946  // Firewall rule added
| project TimeGenerated, Computer, RuleName, 
          RuleId, Direction, Action
| where Direction == "Inbound" and Action == "Allow"</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">SPL: Netsh Firewall Commands</div>
                        <pre><code>index=windows (EventCode=4688 OR EventCode=1)
| where CommandLine LIKE "%netsh%firewall%"
    OR CommandLine LIKE "%netsh%advfirewall%"
| where CommandLine LIKE "%disable%" 
    OR CommandLine LIKE "%set%opmode%"
    OR CommandLine LIKE "%add%rule%"
| table _time, ComputerName, User, CommandLine</code></pre>
                    </div>
                </section>

                <section class="content-section">
                    <h2>UAC & Privilege</h2>
                    
                    <div class="info-box tip">
                        <div class="info-box-title">KQL: UAC Bypass Indicators</div>
                        <pre><code>DeviceProcessEvents
| where TimeGenerated > ago(24h)
| where InitiatingProcessFileName in~ ("explorer.exe", "cmd.exe", "powershell.exe")
| where FileName in~ (
    "fodhelper.exe",
    "computerdefaults.exe", 
    "sdclt.exe",
    "eventvwr.exe",
    "mmc.exe"
)
| where ProcessIntegrityLevel == "High"
| project TimeGenerated, DeviceName, AccountName,
          InitiatingProcessFileName, FileName, ProcessCommandLine</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">SPL: UAC Settings Modified</div>
                        <pre><code>index=windows source="WinRegistry"
| where key_path LIKE "%\\Policies\\System%"
| where ValueName IN (
    "EnableLUA",
    "ConsentPromptBehaviorAdmin",
    "ConsentPromptBehaviorUser",
    "PromptOnSecureDesktop"
)
| where data="0"  // Disabled
| table _time, host, ValueName, data</code></pre>
                    </div>
                </section>

                <section class="content-section">
                    <h2>Credential Protection</h2>
                    
                    <div class="info-box tip">
                        <div class="info-box-title">KQL: LSA Protection Disabled</div>
                        <pre><code>DeviceRegistryEvents
| where TimeGenerated > ago(24h)
| where RegistryKey has @"SYSTEM\CurrentControlSet\Control\Lsa"
| where RegistryValueName in ("RunAsPPL", "LsaCfgFlags")
| where RegistryValueData == "0"
| project TimeGenerated, DeviceName, 
          RegistryValueName, RegistryValueData,
          InitiatingProcessCommandLine</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">SPL: WDigest Credential Caching Enabled</div>
                        <pre><code>index=windows source="WinRegistry"
| where key_path LIKE "%\\Control\\SecurityProviders\\WDigest%"
| where ValueName="UseLogonCredential"
| where data="1"  // Enabled - credentials stored in plaintext
| table _time, host, key_path, ValueName, data</code></pre>
                    </div>
                </section>

                <section class="content-section">
                    <h2>Attack Surface Reduction (ASR)</h2>
                    
                    <div class="info-box tip">
                        <div class="info-box-title">KQL: ASR Rules Triggered</div>
                        <pre><code>DeviceEvents
| where TimeGenerated > ago(24h)
| where ActionType startswith "Asr"
| summarize 
    TriggerCount = count(),
    Devices = dcount(DeviceName),
    SampleCommands = make_set(InitiatingProcessCommandLine, 3)
  by ActionType
| order by TriggerCount desc</code></pre>
                    </div>

                    <div class="info-box">
                        <div class="info-box-title">Key ASR Rules</div>
                        <ul>
                            <li><strong>Block Office apps from creating child processes</strong> - Prevents macro-based attacks</li>
                            <li><strong>Block Office apps from injecting into processes</strong> - Prevents process injection</li>
                            <li><strong>Block credential stealing from LSASS</strong> - Prevents Mimikatz-style attacks</li>
                            <li><strong>Block executable content from email</strong> - Prevents email-borne malware</li>
                            <li><strong>Block untrusted processes from USB</strong> - Prevents USB-based attacks</li>
                        </ul>
                    </div>
                </section>

                <section class="content-section">
                    <h2>Hardening Compliance Dashboard</h2>
                    
                    <div class="info-box tip">
                        <div class="info-box-title">SPL: Security Control Status</div>
                        <pre><code>| inputlookup endpoint_inventory.csv
| join type=left host [
    search index=windows EventCode=7036 Service_Name="WinDefend"
    | dedup host
    | eval defender_status = if(Service_State="running", "Enabled", "Disabled")
    | table host, defender_status
]
| join type=left host [
    search index=windows source="WinRegistry" 
           key_path="*Windows Defender*DisableAntiSpyware*"
    | dedup host
    | eval defender_policy = if(data="1", "Policy Disabled", "Policy OK")
    | table host, defender_policy
]
| fillnull value="Unknown"
| stats count by defender_status, defender_policy
| eval compliance = if(defender_status="Enabled" AND defender_policy="Policy OK", 
                       "Compliant", "Non-Compliant")</code></pre>
                    </div>
                </section>

                <section class="content-section">
                    <div class="info-box interview">
                        <div class="info-box-title">ğŸ’¼ Interview Tip</div>
                        <p><strong>Q: "How do you detect when security controls are being disabled?"</strong></p>
                        <p><strong>A:</strong> "I monitor defense evasion at multiple layers:</p>
                        <ol>
                            <li><strong>Registry monitoring:</strong> Most security controls are configured via registry. I watch for changes to Defender, LSA, UAC, and PowerShell logging keysâ€”specifically for values being set to disabled (usually 0 or 1 depending on the setting).</li>
                            <li><strong>Service monitoring:</strong> Event 7036 tells me when security services stop. WinDefend, EventLog, and security-related services stopping unexpectedly is always investigated.</li>
                            <li><strong>Command-line monitoring:</strong> Tools like netsh for firewall, Set-MpPreference for Defender, and auditpol for audit policy are watched. Any command disabling protections alerts.</li>
                            <li><strong>Process behavior:</strong> I look for patterns like UAC bypass techniquesâ€”specific executables being spawned with high integrity from unexpected parents.</li>
                            <li><strong>Baseline comparison:</strong> I maintain a baseline of expected security configurations and alert on deviations, not just explicit disable commands.</li>
                        </ol>
                        <p>The key insight is that attackers often try to disable security before their main payload. Detecting defense evasion early can stop an attack before data exfiltration."</p>
                    </div>
                </section>

                <section class="content-section">
                    <div class="cheatsheet">
                        <div class="cheatsheet-title">ğŸ“‹ Windows Hardening Quick Reference</div>
                        <h4>Critical Registry Paths</h4>
                        <ul>
                            <li>Defender: <code>HKLM\SOFTWARE\Microsoft\Windows Defender</code></li>
                            <li>LSA: <code>HKLM\SYSTEM\CurrentControlSet\Control\Lsa</code></li>
                            <li>UAC: <code>HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</code></li>
                            <li>PowerShell: <code>HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell</code></li>
                        </ul>
                        <h4>Key Event IDs</h4>
                        <ul>
                            <li>1102 - Security log cleared</li>
                            <li>4719 - Audit policy changed</li>
                            <li>4946 - Firewall rule added</li>
                            <li>4950 - Firewall profile changed</li>
                            <li>7036 - Service state changed</li>
                        </ul>
                        <h4>Defense Evasion Indicators</h4>
                        <ul>
                            <li>Defender exclusions added</li>
                            <li>Audit logging disabled</li>
                            <li>UAC bypass executables</li>
                            <li>AMSI bypass strings</li>
                            <li>LSA protection disabled</li>
                        </ul>
                    </div>
                </section>

                <div style="display: flex; justify-content: space-between; margin-top: var(--spacing-2xl); padding-top: var(--spacing-lg); border-top: 1px solid var(--border-default);">
                    <a href="windows-attack-techniques.html" class="card-link">â† Attack Techniques</a>
                    <a href="active-directory.html" class="card-link">Active Directory â†’</a>
                </div>
            </div>
        </main>
    </div>
    <script src="main.js"></script>
</body>
</html>
